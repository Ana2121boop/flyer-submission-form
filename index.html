<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flyer Submission Form</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />

    </head>
<body>

    <div class="form-container">
        <h1>Flyer Submission</h1>

        <form id="flyerForm" novalidate>
            <section class="form-section">
                <h2>Store & Submission Details</h2>
                <div class="grid two-col">
                    <div class="form-field"><label for="storeNameInput">Store Name:*</label><input type="text" id="storeNameInput" name="storeNameInput" required placeholder="Enter store name"></div>
                    <div class="form-field"><label for="submittedByInput">Submitted By:*</label><input type="text" id="submittedByInput" name="submittedByInput" required placeholder="Enter your name"></div>
                </div>
                <div class="grid two-col" style="margin-top: 15px;"><div class="info-field"><strong>Submission Date:</strong> <span id="submissionDate">--</span></div><div class="info-field"><strong>Last Updated:</strong> <span id="lastUpdated">--</span></div></div>
                <div id="flyer-countdown-section" style="margin-top: 15px; margin-bottom: 15px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px; background-color: #f9f9f9;"><h4>Flyer Readiness Estimate:</h4><p>Your flyer should be ready by approximately: <strong id="flyer-deadline-date-display">Calculating...</strong></p><div id="countdown-timer-display" style="font-size: 1.1em; font-weight: bold; margin-top: 5px;"></div></div>
                <div class="grid two-col" style="margin-top: 15px;"><div class="form-field"><label for="flyerValidStartDate">Flyer Valid Start Date:*</label><input type="date" id="flyerValidStartDate" name="flyerValidStartDate" required></div><div class="form-field"><label for="flyerValidEndDate">Flyer Valid End Date:*</label><input type="date" id="flyerValidEndDate" name="flyerValidEndDate" required></div></div>
                <div class="flyer-options-container" style="margin-top: 15px; margin-bottom: 15px;"><fieldset><legend style="font-weight: bold; margin-bottom: 5px;">Flyer Distribution Options:</legend><div class="toggle-option"><input type="checkbox" id="canadaPostFlyer" name="canadaPostFlyer" value="yes"><label for="canadaPostFlyer">Canada Post Flyer</label></div><div class="toggle-option" style="margin-top: 5px;"><input type="checkbox" id="digitalInStoreFlyer" name="digitalInStoreFlyer" value="yes"><label for="digitalInStoreFlyer">Digital / In-Store Flyer</label></div></fieldset></div>
                <div class="form-field" style="margin-top: 15px;"><label for="generalNotes">General Notes:</label><textarea id="generalNotes" name="generalNotes" rows="4" placeholder="Any overall comments or instructions..."></textarea></div>
            </section>

            <section class="form-section flyer-products-section" data-editing="true" data-dirty="false">
                <h2>Flyer Products (Page 1 - Max 8 Slots)</h2>
                <p class="save-reminder-note error-message" style="display: none; font-weight: bold;">Please save changes to this page before proceeding.</p>
                <div id="flyerProductsGrid" class="products-grid-container four-columns"></div>
                <p id="flyerProductCounter" style="margin-top:10px; text-align: right;">Slots Filled: 0 / 8</p>
                <div class="page-actions"><button type="button" id="editSaveFlyerBtn" class="edit-save-page-btn button button-primary" data-mode="save">Save Page</button></div>
                <p id="productSubmitError" class="error-message" style="display: none;">At least one product is required.</p>
            </section>

            <section class="form-section additional-pages-section">
                <div id="additionalPagesContainer">
                    </div>
                <div class="additional-pages-controls" style="text-align: center; margin: 20px 0 30px 0;">
                    <button type="button" id="addNewPageBtn" class="button button-secondary">Add New Page (4x4 Grid)</button>
                </div>
            </section>

            <section class="form-section" id="socialMediaSection">
                <h2>Social Media Promotion (Max 7)</h2>
                <p id="socialCounterDisplay" style="font-weight: bold; margin-bottom: 15px;">Items selected: 0 / 7</p>
                <div id="socialItemsList" class="social-list-container">
                    </div>
            </section>

            <section class="form-section">
                <h2>Print Marketing Requests</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="reqPriceTags" name="reqPriceTags"> Price Tags</label>
                    <label><input type="checkbox" id="reqPosters" name="reqPosters"> Posters</label>
                    <label><input type="checkbox" id="reqSignage" name="reqSignage"> In-Store Signage / Banners</label>
                </div>
                <div class="form-field">
                    <label for="printNotes">Notes for Print Team:</label>
                    <textarea id="printNotes" name="printNotes" rows="3" placeholder="Specific quantities, sizes, or instructions..."></textarea>
                </div>
            </section>

            <div class="submit-container">
                <p id="formError" class="error-message" style="display: none;"></p>
                <button type="submit" id="submitBtn" class="button button-primary">Submit Flyer</button>
            </div>
        </form>

        <section id="adminSection" style="display: none; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc;">
            <div id="adminLogin">
                <h2>Admin Login</h2>
                <form id="adminLoginForm" novalidate>
                    <div class="form-field"><label for="adminUsername">Username:</label><input type="text" id="adminUsername" name="adminUsername" required></div>
                    <div class="form-field"><label for="adminPassword">Password:</label><input type="password" id="adminPassword" name="adminPassword" required></div>
                    <button type="submit" class="button button-primary">Login</button>
                    <p id="adminLoginError" class="error-message" style="display: none;"></p>
                </form>
            </div>
            <div id="adminDashboard" style="display: none;">
                <h2>Admin Dashboard</h2>
                <p id="adminGreeting" style="font-style: italic; margin-bottom: 15px; color: #0056b3;"></p>
                
                <button id="adminLogoutBtn" class="button button-secondary" style="float: right;">Logout</button>
                <div style="clear: both; margin-bottom: 20px;"></div>


                <div id="adminFilters" class="form-section" style="padding:15px; border:1px solid #ddd; margin-bottom:20px; background-color:#f9f9f9; border-radius: 5px;">
                    <h3>Filter Submissions</h3>
                    <div class="grid three-col">
                        <div class="form-field">
                            <label for="filterDateStart">Submitted After:</label>
                            <input type="date" id="filterDateStart" name="filterDateStart">
                        </div>
                        <div class="form-field">
                            <label for="filterDateEnd">Submitted Before:</label>
                            <input type="date" id="filterDateEnd" name="filterDateEnd">
                        </div>
                        <div class="form-field">
                            <label for="filterStoreName">Store Name:</label>
                            <input type="text" id="filterStoreName" name="filterStoreName" placeholder="Enter store name to filter">
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: right;">
                        <button type="button" id="applyFiltersBtn" class="button button-secondary">Apply Filters</button>
                        <button type="button" id="clearFiltersBtn" class="button button-tertiary">Clear Filters</button>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <button type="button" id="deleteSelectedSubmissionsBtn" class="button button-danger" style="display: none;">Delete Selected (<span id="selectedSubmissionsCount">0</span>)</button>
                </div>
                
                <h3>All Submissions</h3>
                <div id="adminSubmissionsList"> <p>Loading submissions...</p></div>
            </div>
        </section>
        <div style="text-align: right; margin-top: 20px; margin-bottom: 20px;">
            <button id="showAdminLoginBtn" class="button button-tertiary">Admin Access</button>
        </div>
    </div> 

    <template id="productFormFieldsTemplate">
        <div class="grid three-col">
            <div class="form-field"><label>Product Name:*</label><input type="text" name="productName" required placeholder="e.g., Premium Latex Paint"></div>
            <div class="form-field"><label>Brand Name:*</label><input type="text" name="brandName" required placeholder="e.g., ColorPro"></div>
            <div class="form-field"><label>Category:*</label><select name="category" required><option value="" disabled selected>Select...</option><option value="Lumber">Lumber</option><option value="Mouldings">Mouldings</option><option value="Paint">Paint</option><option value="Tools">Tools</option><option value="Hardware">Hardware</option><option value="Other">Other</option></select></div>
            <div class="form-field"><label>Size/Dimensions:</label><input type="text" name="sizeDimensions" placeholder="e.g., 1 Gallon or 2x4x8"></div>
            <div class="form-field"><label>Colour/Finish:</label><input type="text" name="colourFinish" placeholder="e.g., Eggshell White"></div>
            <div class="form-field"><label>Store SKU:</label><input type="text" name="sku" placeholder="Optional product SKU"></div>
            <div class="form-field"><label>Regular Price:*</label><input type="number" name="regularPrice" step="0.01" min="0" required class="price-input" placeholder="e.g., 45.50"></div>
            <div class="form-field"><label>Sale Price:*</label><input type="number" name="salePrice" step="0.01" min="0" required class="price-input" placeholder="e.g., 39.99"></div>
            <div class="form-field"><label>Discount %:</label><input type="text" name="discountPercent" readonly disabled class="discount-display" placeholder="Auto-calculated"></div>
            <div class="form-field manual-discount-field" style="display: none;"><label>Manual Discount Description:</label><input type="text" name="manualDiscountDescription" class="manual-discount-input" placeholder="e.g., 20% Off MSRP, Staff Discount"></div>
        </div>
        <div class="form-field"><label>Special Features:</label><textarea name="specialFeatures" rows="2" placeholder="e.g., Low VOC, Lifetime Warranty"></textarea></div>
        <div class="checkbox-group">
            <label><input type="checkbox" name="isMainFlyerProduct"> Main Flyer Product?</label>
            <label><input type="checkbox" name="isBundle" class="bundle-checkbox"> Is this a Bundle?</label>
            <label><input type="checkbox" name="requestStockImage"> Request Stock Image?</label>
            <label><input type="checkbox" name="includeInSocial" class="social-checkbox"> Include in Social Media?</label>
        </div>
        <div class="form-field bundle-items-container" style="display: none;"><label>Additional Items in Bundle:*</label><textarea name="bundleItems" rows="2" placeholder="List items included in the bundle..."></textarea></div>
        <div class="form-field"><label>Upload Custom Product Image (Optional):</label><input type="file" name="productImage" accept="image/*" class="product-image-input"><div class="image-preview"><small>No image selected.</small></div></div>
    </template>

    <template id="productDisplayTemplate">
        <div class="product-item list-item" data-product-id="">
            <div class="product-display-content"></div><img src="" alt="Product Preview" class="product-preview-img" style="display: none;">
            <div class="product-item-actions">
                <button type="button" class="edit-product-btn button button-secondary" title="Edit Product">Edit</button>
                <button type="button" class="remove-item-btn button-danger" title="Remove Product">&times;</button>
            </div>
        </div>
    </template>

    <template id="newPageSectionTemplate">
        <div class="page-section" data-editing="true" data-dirty="false">
            <h3 class="page-title">Page Title Here</h3>
            <p class="save-reminder-note error-message" style="display: none; font-weight: bold;">Please save changes to this page before proceeding.</p>
            <div class="products-grid-container four-columns new-page-grid"></div>
            <p class="page-product-counter" style="margin-top:10px; text-align: right;">Slots Filled: 0 / 16</p>
            <div class="page-actions">
                <button type="button" class="edit-save-page-btn button button-primary" data-mode="save">Save Page</button>
                <button type="button" class="remove-page-btn button button-danger">Remove Page</button>
            </div>
        </div>
    </template>

    <div id="productEditModal" class="modal-overlay">
        <div class="modal-box product-edit-modal-box">
            <button type="button" id="productEditCloseBtn" class="modal-close-btn" title="Close">&times;</button>
            <h2>Add/Edit Product</h2>
            <div id="productEditArea" class="product-edit-container">
                <div id="productFormFieldsContainer"></div>
                <div class="product-edit-actions">
                    <button type="button" id="saveProductBtn" class="button button-primary">Save Product</button>
                    <button type="button" id="cancelProductBtn" class="button button-secondary">Cancel</button>
                </div>
                <p id="productEditError" class="error-message" style="display: none;"></p>
            </div>
        </div>
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-box">
            <button type="button" id="modalCloseBtn" class="modal-close-btn" title="Close">&times;</button>
            <h2>Success!</h2>
            <p id="modalMessage">Your action was successful.</p>
        </div>
    </div>

    <div id="submissionDetailModal" class="modal-overlay">
        <div class="modal-box" style="text-align: left; position: relative;"> <button type="button" id="submissionDetailCloseBtn" class="modal-close-btn" title="Close">&times;</button> <button type="button" id="extractPdfBtn" class="button button-danger">Extract as PDF</button> <h2>Submission Details</h2>
            <div id="submissionDetailContent">
                <p>Loading details...</p>
            </div>
        </div>
    </div>

    <div id="forceSaveModal" class="modal-overlay">
        <div class="modal-box force-save-modal-box">
            <button type="button" class="modal-close-btn force-save-close-btn" title="Close">&times;</button>
            <h2 style="color: #dc3545;">Unsaved Changes</h2>
            <p>Please save changes to the current page section before proceeding.</p>
            <div class="force-save-actions" style="margin-top: 25px;">
                <button type="button" id="forceSaveBtn" class="button button-primary">Save Page Now</button>
                <button type="button" id="forceSaveCancelBtn" class="button button-secondary">Back to Edit</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

    <script src="script.js"></script>
</body>
</html>